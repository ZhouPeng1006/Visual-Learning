<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="ASTVisio.css">
</head>

<body>
<div id="container">
    <div id="control-panel">
        <button id="run-button">Run</button>
    </div>
    <div id="content">
        <div id="code-area">
            <div id="line-numbers"></div>
            <textarea id="code-input" rows="10" oninput="updateLineNumbers()"></textarea>
        </div>
        <div id="resizer"></div>
        <div id="tree-area">
            <svg id="tree-svg">
                <!-- A test  -->
                <rect x="50" y="50" width="100" height="100" fill="blue"/>
            </svg>
        </div>
    </div>
</div>

<script>
    // Resize logic
    const resizer = document.getElementById('resizer');
    const codeArea = document.getElementById('code-area');
    const treeArea = document.getElementById('tree-area');
    const runCode = document.getElementById('run-button');

    resizer.addEventListener('mousedown', initResize, false);
    runCode.addEventListener('click', function() {sendCodeToBackend();});

    function initResize(e) {
        window.addEventListener('mousemove', resize, false);
        window.addEventListener('mouseup', stopResize, false);
    }

    function resize(e) {
        const x = e.pageX;
        const codeWidth = codeArea.offsetWidth;
        const treeWidth = treeArea.offsetWidth;
        const containerWidth = codeWidth + treeWidth;

        const newCodeWidth = codeWidth + (x - codeWidth);
        const newTreeWidth = treeWidth - (x - codeWidth);

        if (newCodeWidth > 0 && newTreeWidth > 0 && containerWidth > 0) {
            codeArea.style.flexBasis = `${(newCodeWidth / containerWidth) * 100}%`;
            treeArea.style.flexBasis = `${(newTreeWidth / containerWidth) * 100}%`;
        }
    }

    function stopResize() {
        window.removeEventListener('mousemove', resize, false);
        window.removeEventListener('mouseup', stopResize, false);
    }


    // Line Number
    function updateLineNumbers() {
        var codeInput = document.getElementById('code-input');
        var lineNumbers = document.getElementById('line-numbers');

        var codeLines = codeInput.value.split('\n');
        var lineNumbersHTML = '';

        for (var i = 1; i <= codeLines.length; i++) {
            lineNumbersHTML += i + '<br>';
        }

        lineNumbers.innerHTML = lineNumbersHTML;
    }

    window.onload = function () {
        updateLineNumbers();
    };

    // Send Code
    function sendCodeToBackend() {
        var code = document.getElementById('code-input').value;
        var data = {
            code: code
        };
        var jsonData = JSON.stringify(data);

        fetch('/parse', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: jsonData
        })
            .then(response => response.json())
            .then(result => {
                // 处理后端返回的结果
                console.log(result);
            })
            .catch(error => {
                // 处理错误
                console.error('Error:', error);
            });
    }


</script>
</body>

</html>